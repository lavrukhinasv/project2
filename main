import telebot  # Импортирует библиотеку для работы с Telegram Bot API
import random  # Импортирует модуль для работы с случайными числами
from pydub import AudioSegment  # Импортирует модуль для работы с аудиофайлами
from transformers import pipeline  # Импортирует конвейер для использования моделей Hugging Face
from telebot import types  # Импортирует типы сообщений для создания кнопок и клавиатур в Telegram
from exceptions import InvalidDeckException, InvalidMessageTypeException  # Импортирует исключения для обработки ошибок
from decorators import validate_deck  # Импортирует декоратор для проверки колоды карт

bot = telebot.TeleBot('7682576928:AAFX9MAMInHsx6XnJMWC6uyXu7SyeInIueA')  # Токен
magic_ai = pipeline("text2text-generation", model="t5-small")  # Инициализация ИИ

# Список карт, предсказаний и путей к изображениям
cards_decks = {
    "tarot1": [
    {"name": "Шут", "prediction": "Нулевая карта в колоде Таро, Шут, обладает бесконечным потенциалом и чаще всего выпадает людям, которые находятся в начале жизненного пути. Им еще только предстоит принятие серьезных решений.Основное значение этой карты — невинность, начало пути, предвещающего что-то новое и неизведанное ранее. В трактовке аркана нет ничего зловещего, акцент смещен на эксцентричность персонажа, его необычный взгляд на мир. Карта советует попробовать нестандартные решения, новые теории. Однако в символике аркана заложено также предостережение: необходимо смотреть под ноги и по сторонам, а не погружаться полностью в свои мечты.", "image": "https://sun9-40.userapi.com/impf/c854228/v854228252/15a260/4c9q-BMH72I.jpg?size=194x362&quality=96&sign=11e03d6aca454f66bce24700b073693c&type=album"},
    {"name": "Маг", "prediction": "Карта Мага является предвестником исполнения желания. В Таро Маг говорит об успехе в деле. А именно удачное стечение обстоятельств, которые помогут осуществить вашу мечту. 1 аркан как бы намекает, что сейчас самое время двинуться навстречу своему желанию, для этого у вас есть все ресурсы. Все находится под вашим контролем, и вам нужно действовать активно, спешить использовать это время. Чтобы все сложилось удачно, нужно проявить свою волю, сконцентрироваться на деле. Если говорить конкретно, то все зависит от вас. Будь то романтические, творческие, профессиональные, духовные замыслы, они обязательно исполнятся, как по мановению волшебной палочки Мага. А чтобы не забыть об этом благоприятном времени, установите обои с картой Мага на свой телефон, и он будет вас вдохновлять.", "image": "https://sun9-1.userapi.com/impf/c854228/v854228252/15a267/0fpbWS0ETb0.jpg?size=194x362&quality=96&sign=f67ec096baae2333df40f496c40ade17&type=album"},
    {"name": "Жрица", "prediction": "2 аркан говорит, что истина находится внутри вас. Подсознательно вы знаете ответ на вопрос, нужно лишь сосредоточиться и успокоиться, возможно, побыть некоторое время в одиночестве. Иногда Жрица может указывать на воспоминания, неприятные события в прошлом, которые как-то влияют на вашу жизнь. Если в раскладе выпадает Жрица, то в делах нужно проявить мудрость и терпение, тогда дело будет успешным. ", "image": "https://sun9-2.userapi.com/impf/c854228/v854228252/15a26e/jniVq3mnFw4.jpg?size=194x362&quality=96&sign=7c66226f74fdfdc210d4ab3ae3f4f654&type=album"},
    {"name": "Императрица", "prediction": "Карта Императрицы предвещает жизнь, наполненную гармонией, стабильность, заботу о близких, благоприятную расстановку сил в любом деле. Если в раскладе появляется эта карта, значит, перед вами открыты все пути. Она несет творческую энергию и может предрекать начало нового проекта, отличные возможности для реализации потенциала, раскрытие природного таланта. Иногда выпавшая карта Хозяйки говорит о будущей беременности, а для неженатых/незамужних означает вступление в брак. 3 аркан материализует важную женскую фигуру, покровительницу, которая поможет в решении важного вопроса, направит на истинный путь, даст совет ,как поступить в сложной ситуации.", "image": "https://sun9-72.userapi.com/impf/c854228/v854228252/15a275/lGUdUZaJOq0.jpg?size=194x362&quality=96&sign=9ac686a6efbfcc1ed80884d01b51a645&type=album"},
    {"name": "Император", "prediction": "В любых раскладах 4 аркан означает, в первую очередь, мужскую фигуру, властного человека, самоутверждение за счет денег и материальных благ. Император говорит, что человек несет ответственность не только за себя, но и за свой коллектив, за семью. Это отличные перспективы, надежность дела, стабильность в отношениях, рациональность и большие возможности. Если выпадает Император, значит, человек основывается на разуме, не берет в расчет чувства и эмоции. В определенных раскладах Хозяин может появляться в качестве четких границ в общении, важности следования законам и социальным нормам.", "image": "https://sun9-51.userapi.com/impf/c854228/v854228252/15a27c/F_0V8lUpSgQ.jpg?size=194x362&quality=96&sign=44fb108b97d941cf046653bf68172e44&type=album"},
    {"name": "Иерофант", "prediction": "В общем смысле карта означает воплощение духовного мира, который помогает человеку развиваться, осознавать истинные ценности. Если рассматривать как человеческую фигуру, это наставник, человек, который значительно старше вас, направляющий на правильный путь. Это может быть книга, которая случайно попала к вам в руки, и из нее вы почерпнули серьезное или важное изречение., фильм или учение, руководствуясь которым, вы стали мудрее и добрались до истины. Может символизировать учреждение, где дают знания: школу, институт, религиозные семинарии и церковь. Если речь идет о каком-то деле и выходит карта Иерофанта, значит, развитие ситуации будет зависеть от моральных устоев – пойдете ли вы на сделку со своей совестью.", "image": "https://sun9-56.userapi.com/impf/c854228/v854228252/15a283/lBpsUjR3QDc.jpg?size=194x362&quality=96&sign=ffd6056014f08dacd17ad776c0057ef5&type=album"},
    {"name": "Влюбленные", "prediction": "Карта Таро Любовники может означать, что вам предстоит сделать важный выбор, который изменит вашу жизнь, или вы столкнетесь с дилеммой. Искушение часто является частью этого выбора или дилеммы.Во-первых, соберите информацию, необходимую для принятия правильного решения. Если вы столкнетесь с проблемой и мудро обдумаете ее, это приведет вас к большим вещам", "image": "https://sun9-23.userapi.com/impf/c854228/v854228252/15a28a/KEZWhP_fPy0.jpg?size=194x362&quality=96&sign=528a414fad904cd9f10162e9f29586cb&type=album"},
    {"name": "Колесница", "prediction": "Когда в раскладе Таро появляется прямая карта Колесница , это говорит вам, что сейчас самое время получить то, что вы хотите. Считайте эту карту знаком поддержки. Карта Таро Колесница — это преодоление препятствий и достижение цели с помощью решимости, сосредоточенности и силы воли. Вы почувствуете мотивацию, амбициозность и контроль.Это поможет вам снова сдвинуть застойную ситуацию и преодолеть все трудности, которые могут встретиться на вашем пути. Просто сосредоточьтесь и верьте в свои способности, и вы добьетесь своей цели. Колесница говорит вам, что вас ждет триумф и что вы полностью контролируете его осуществление. Это может означать, что вам придется соревноваться с другими или что вы окажетесь в ситуации, похожей на битву. Вас тянет в противоположные стороны или вы чувствуете, что ваша сила и уверенность подвергаются испытанию.", "image": "https://sun9-71.userapi.com/impf/c854228/v854228252/15a291/Ms7SKZGX-_g.jpg?size=194x362&quality=96&sign=3f9fcc652abfcc40f7992bb570fa24bd&type=album"},
    {"name": "Справедливость", "prediction": "Карта Таро Любовники может означать, что вам предстоит сделать важный выбор, который изменит вашу жизнь, или вы столкнетесь с дилеммой. Искушение часто является частью этого выбора или дилеммы.Во-первых, соберите информацию, необходимую для принятия правильного решения. Если вы столкнетесь с проблемой и мудро обдумаете ее, это приведет вас к большим вещам", "image": "https://sun9-41.userapi.com/impf/c854228/v854228252/15a298/5YW4Sa7EGgc.jpg?size=194x362&quality=96&sign=c93171bc44fd34ddd4736459d217322f&type=album"},
    {"name": "Отшельник", "prediction": "Карта Таро Любовники может означать, что вам предстоит сделать важный выбор, который изменит вашу жизнь, или вы столкнетесь с дилеммой. Искушение часто является частью этого выбора или дилеммы.Во-первых, соберите информацию, необходимую для принятия правильного решения. Если вы столкнетесь с проблемой и мудро обдумаете ее, это приведет вас к большим вещам", "image": "https://sun9-8.userapi.com/impf/c854228/v854228252/15a29f/llqU1TTqsCQ.jpg?size=194x362&quality=96&sign=d3e85f9c953c9339a9672adac47bb639&type=album"},
    {"name": "Колесо фортуны", "prediction": "Карта Императрицы предвещает жизнь, наполненную гармонией, стабильность, заботу о близких, благоприятную расстановку сил в любом деле. Если в раскладе появляется эта карта, значит, перед вами открыты все пути. Она несет творческую энергию и может предрекать начало нового проекта, отличные возможности для реализации потенциала, раскрытие природного таланта. Иногда выпавшая карта Хозяйки говорит о будущей беременности, а для неженатых/незамужних означает вступление в брак. 3 аркан материализует важную женскую фигуру, покровительницу, которая поможет в решении важного вопроса, направит на истинный путь, даст совет ,как поступить в сложной ситуации.", "image": "https://sun9-33.userapi.com/impf/c854228/v854228252/15a2a6/BMg6K8KvMm8.jpg?size=194x362&quality=96&sign=e2ba3d025308c9e423c2b46ca6554da4&type=album"},
    {"name": "Сила", "prediction": "В общем смысле карта означает воплощение духовного мира, который помогает человеку развиваться, осознавать истинные ценности. Если рассматривать как человеческую фигуру, это наставник, человек, который значительно старше вас, направляющий на правильный путь. Это может быть книга, которая случайно попала к вам в руки, и из нее вы почерпнули серьезное или важное изречение., фильм или учение, руководствуясь которым, вы стали мудрее и добрались до истины. Может символизировать учреждение, где дают знания: школу, институт, религиозные семинарии и церковь. Если речь идет о каком-то деле и выходит карта Иерофанта, значит, развитие ситуации будет зависеть от моральных устоев – пойдете ли вы на сделку со своей совестью.", "image": "https://sun9-56.userapi.com/impf/c854228/v854228252/15a2ad/r2wkOwNCmeg.jpg?size=194x362&quality=96&sign=6e758863f61073422d2faf48fcc3ba2f&type=album"},
    {"name": "Повешенный", "prediction": "Карта Таро Любовники может означать, что вам предстоит сделать важный выбор, который изменит вашу жизнь, или вы столкнетесь с дилеммой. Искушение часто является частью этого выбора или дилеммы.Во-первых, соберите информацию, необходимую для принятия правильного решения. Если вы столкнетесь с проблемой и мудро обдумаете ее, это приведет вас к большим вещам", "image": "https://sun9-79.userapi.com/impf/c854228/v854228252/15a2b4/JTfvdkU5sfY.jpg?size=194x362&quality=96&sign=6da5075053f6525bd9f262fa3ef40196&type=album"},
    {"name": "Смерть", "prediction": "Когда в раскладе Таро появляется прямая карта Колесница , это говорит вам, что сейчас самое время получить то, что вы хотите. Считайте эту карту знаком поддержки. Карта Таро Колесница — это преодоление препятствий и достижение цели с помощью решимости, сосредоточенности и силы воли. Вы почувствуете мотивацию, амбициозность и контроль.Это поможет вам снова сдвинуть застойную ситуацию и преодолеть все трудности, которые могут встретиться на вашем пути. Просто сосредоточьтесь и верьте в свои способности, и вы добьетесь своей цели. Колесница говорит вам, что вас ждет триумф и что вы полностью контролируете его осуществление. Это может означать, что вам придется соревноваться с другими или что вы окажетесь в ситуации, похожей на битву. Вас тянет в противоположные стороны или вы чувствуете, что ваша сила и уверенность подвергаются испытанию.", "image": "https://sun9-29.userapi.com/impf/c854228/v854228252/15a2bb/WK-ZpGSUGrU.jpg?size=194x362&quality=96&sign=96f482e0aa45eb467adbdc6da94edd0d&type=album"},
    {"name": "Умеренность", "prediction": "Карта Таро Любовники может означать, что вам предстоит сделать важный выбор, который изменит вашу жизнь, или вы столкнетесь с дилеммой. Искушение часто является частью этого выбора или дилеммы.Во-первых, соберите информацию, необходимую для принятия правильного решения. Если вы столкнетесь с проблемой и мудро обдумаете ее, это приведет вас к большим вещам", "image": "https://sun9-21.userapi.com/impf/c854228/v854228252/15a2c2/sp7jAy5wDq8.jpg?size=194x362&quality=96&sign=0d2ebb270d3de294e40ac6d703951996&type=album"},
    {"name": "Дьявол","prediction": "В любых раскладах 4 аркан означает, в первую очередь, мужскую фигуру, властного человека, самоутверждение за счет денег и материальных благ. Император говорит, что человек несет ответственность не только за себя, но и за свой коллектив, за семью. Это отличные перспективы, надежность дела, стабильность в отношениях, рациональность и большие возможности. Если выпадает Император, значит, человек основывается на разуме, не берет в расчет чувства и эмоции. В определенных раскладах Хозяин может появляться в качестве четких границ в общении, важности следования законам и социальным нормам.","image": "https://sun9-79.userapi.com/impf/c854228/v854228252/15a2c9/V3hVXq4akvY.jpg?size=194x362&quality=96&sign=1652a17b52bb32b75fe71bc3fa35d4e9&type=album"},
    {"name": "Башня", "prediction": "В общем смысле карта означает воплощение духовного мира, который помогает человеку развиваться, осознавать истинные ценности. Если рассматривать как человеческую фигуру, это наставник, человек, который значительно старше вас, направляющий на правильный путь. Это может быть книга, которая случайно попала к вам в руки, и из нее вы почерпнули серьезное или важное изречение., фильм или учение, руководствуясь которым, вы стали мудрее и добрались до истины. Может символизировать учреждение, где дают знания: школу, институт, религиозные семинарии и церковь. Если речь идет о каком-то деле и выходит карта Иерофанта, значит, развитие ситуации будет зависеть от моральных устоев – пойдете ли вы на сделку со своей совестью.", "image": "https://sun9-61.userapi.com/impf/c854228/v854228252/15a2d0/aEl1dOFz1Ig.jpg?size=194x362&quality=96&sign=b8ec103bbc894de017ff0f2525daea38&type=album"},
    {"name": "Звезда","prediction": "Карта Таро Любовники может означать, что вам предстоит сделать важный выбор, который изменит вашу жизнь, или вы столкнетесь с дилеммой. Искушение часто является частью этого выбора или дилеммы.Во-первых, соберите информацию, необходимую для принятия правильного решения. Если вы столкнетесь с проблемой и мудро обдумаете ее, это приведет вас к большим вещам", "image": "https://sun9-70.userapi.com/impf/c854228/v854228252/15a2d7/c_GS5GeBklk.jpg?size=194x362&quality=96&sign=c59682af810bd295a1b9618904a6af6c&type=album"},
    {"name": "Луна", "prediction": "Когда в раскладе Таро появляется прямая карта Колесница , это говорит вам, что сейчас самое время получить то, что вы хотите. Считайте эту карту знаком поддержки. Карта Таро Колесница — это преодоление препятствий и достижение цели с помощью решимости, сосредоточенности и силы воли. Вы почувствуете мотивацию, амбициозность и контроль.Это поможет вам снова сдвинуть застойную ситуацию и преодолеть все трудности, которые могут встретиться на вашем пути. Просто сосредоточьтесь и верьте в свои способности, и вы добьетесь своей цели. Колесница говорит вам, что вас ждет триумф и что вы полностью контролируете его осуществление. Это может означать, что вам придется соревноваться с другими или что вы окажетесь в ситуации, похожей на битву. Вас тянет в противоположные стороны или вы чувствуете, что ваша сила и уверенность подвергаются испытанию.", "image": "https://sun9-53.userapi.com/impf/c854228/v854228252/15a2de/Bs4c-RQm-Gc.jpg?size=194x362&quality=96&sign=2607bf2551d95fa5ba9646a9e9e3e237&type=album"},
    {"name": "Солнце", "prediction": "Карта Таро Любовники может означать, что вам предстоит сделать важный выбор, который изменит вашу жизнь, или вы столкнетесь с дилеммой. Искушение часто является частью этого выбора или дилеммы.Во-первых, соберите информацию, необходимую для принятия правильного решения. Если вы столкнетесь с проблемой и мудро обдумаете ее, это приведет вас к большим вещам", "image": "https://sun9-41.userapi.com/impf/c854228/v854228252/15a298/5YW4Sa7EGgc.jpg?size=194x362&quality=96&sign=c93171bc44fd34ddd4736459d217322f&type=album"},
    {"name": "Суд","prediction": "Карта Таро Любовники может означать, что вам предстоит сделать важный выбор, который изменит вашу жизнь, или вы столкнетесь с дилеммой. Искушение часто является частью этого выбора или дилеммы.Во-первых, соберите информацию, необходимую для принятия правильного решения. Если вы столкнетесь с проблемой и мудро обдумаете ее, это приведет вас к большим вещам", "image": "https://sun9-14.userapi.com/impf/c854228/v854228252/15a2ec/as9cDGHx_CU.jpg?size=194x362&quality=96&sign=11eccef8bee2c1860525f277c68d9e47&type=album"},
    {"name": "Мир", "prediction": "Карта Императрицы предвещает жизнь, наполненную гармонией, стабильность, заботу о близких, благоприятную расстановку сил в любом деле. Если в раскладе появляется эта карта, значит, перед вами открыты все пути. Она несет творческую энергию и может предрекать начало нового проекта, отличные возможности для реализации потенциала, раскрытие природного таланта. Иногда выпавшая карта Хозяйки говорит о будущей беременности, а для неженатых/незамужних означает вступление в брак. 3 аркан материализует важную женскую фигуру, покровительницу, которая поможет в решении важного вопроса, направит на истинный путь, даст совет ,как поступить в сложной ситуации.","image": "https://sun9-42.userapi.com/impf/c854228/v854228252/15a2f3/EAVnkeS7T_8.jpg?size=194x362&quality=96&sign=9c43b937a93d6c910da36d81eafdf8bb&type=album"},
    {"name": "Тройка кубов", "prediction": "Нулевая карта в колоде Таро, Шут, обладает бесконечным потенциалом и чаще всего выпадает людям, которые находятся в начале жизненного пути. Им еще только предстоит принятие серьезных решений.Основное значение этой карты — невинность, начало пути, предвещающего что-то новое и неизведанное ранее. В трактовке аркана нет ничего зловещего, акцент смещен на эксцентричность персонажа, его необычный взгляд на мир. Карта советует попробовать нестандартные решения, новые теории. Однако в символике аркана заложено также предостережение: необходимо смотреть под ноги и по сторонам, а не погружаться полностью в свои мечты.","image": "https://sun9-5.userapi.com/impf/c854228/v854228252/15a308/bhpi4CmkDgE.jpg?size=194x362&quality=96&sign=17ee1ee8f2317b1b8e4be52673b37873&type=album"},
    {"name": "Четверка кубов","prediction": "Карта Мага является предвестником исполнения желания. В Таро Маг говорит об успехе в деле. А именно удачное стечение обстоятельств, которые помогут осуществить вашу мечту. 1 аркан как бы намекает, что сейчас самое время двинуться навстречу своему желанию, для этого у вас есть все ресурсы. Все находится под вашим контролем, и вам нужно действовать активно, спешить использовать это время. Чтобы все сложилось удачно, нужно проявить свою волю, сконцентрироваться на деле. Если говорить конкретно, то все зависит от вас. Будь то романтические, творческие, профессиональные, духовные замыслы, они обязательно исполнятся, как по мановению волшебной палочки Мага. А чтобы не забыть об этом благоприятном времени, установите обои с картой Мага на свой телефон, и он будет вас вдохновлять.", "image": "https://sun9-33.userapi.com/impf/c854228/v854228252/15a30f/I-j8jqRIc0k.jpg?size=194x362&quality=96&sign=bf67887ce66e1fabc839bd5da606727b&type=album"},
    {"name": "Пятерка кубов", "prediction": "2 аркан говорит, что истина находится внутри вас. Подсознательно вы знаете ответ на вопрос, нужно лишь сосредоточиться и успокоиться, возможно, побыть некоторое время в одиночестве. Иногда Жрица может указывать на воспоминания, неприятные события в прошлом, которые как-то влияют на вашу жизнь. Если в раскладе выпадает Жрица, то в делах нужно проявить мудрость и терпение, тогда дело будет успешным. ", "image": "https://sun9-25.userapi.com/impf/c854228/v854228252/15a316/GUyUdp5aFvI.jpg?size=194x362&quality=96&sign=1aa0c7d353f035c84947ae37d18718b9&type=album"},
    {"name": "Шестерка кубов", "prediction": "Карта Императрицы предвещает жизнь, наполненную гармонией, стабильность, заботу о близких, благоприятную расстановку сил в любом деле. Если в раскладе появляется эта карта, значит, перед вами открыты все пути. Она несет творческую энергию и может предрекать начало нового проекта, отличные возможности для реализации потенциала, раскрытие природного таланта. Иногда выпавшая карта Хозяйки говорит о будущей беременности, а для неженатых/незамужних означает вступление в брак. 3 аркан материализует важную женскую фигуру, покровительницу, которая поможет в решении важного вопроса, направит на истинный путь, даст совет ,как поступить в сложной ситуации.", "image": "https://sun9-66.userapi.com/impf/c854228/v854228252/15a31d/zvHh6C7bW-E.jpg?size=194x362&quality=96&sign=6179f65e70ea46fddd7d700699263daa&type=album"},
    {"name": "Семерка кубов", "prediction": "В любых раскладах 4 аркан означает, в первую очередь, мужскую фигуру, властного человека, самоутверждение за счет денег и материальных благ. Император говорит, что человек несет ответственность не только за себя, но и за свой коллектив, за семью. Это отличные перспективы, надежность дела, стабильность в отношениях, рациональность и большие возможности. Если выпадает Император, значит, человек основывается на разуме, не берет в расчет чувства и эмоции. В определенных раскладах Хозяин может появляться в качестве четких границ в общении, важности следования законам и социальным нормам.","image": "https://sun9-36.userapi.com/impf/c854228/v854228252/15a324/1qHNHm_XDu8.jpg?size=194x362&quality=96&sign=d3fb70a4c027341efc59439c2db5695d&type=album"},
    {"name": "Восьмерка кубов","prediction": "В общем смысле карта означает воплощение духовного мира, который помогает человеку развиваться, осознавать истинные ценности. Если рассматривать как человеческую фигуру, это наставник, человек, который значительно старше вас, направляющий на правильный путь. Это может быть книга, которая случайно попала к вам в руки, и из нее вы почерпнули серьезное или важное изречение., фильм или учение, руководствуясь которым, вы стали мудрее и добрались до истины. Может символизировать учреждение, где дают знания: школу, институт, религиозные семинарии и церковь. Если речь идет о каком-то деле и выходит карта Иерофанта, значит, развитие ситуации будет зависеть от моральных устоев – пойдете ли вы на сделку со своей совестью.","image": "https://sun9-79.userapi.com/impf/c854228/v854228252/15a32b/oCdIuXp7QZ4.jpg?size=194x362&quality=96&sign=fd6e33668d5a4e3a3c1b2eabffc57af0&type=album"},
    {"name": "Девятка кубов","prediction": "Карта Таро Любовники может означать, что вам предстоит сделать важный выбор, который изменит вашу жизнь, или вы столкнетесь с дилеммой. Искушение часто является частью этого выбора или дилеммы.Во-первых, соберите информацию, необходимую для принятия правильного решения. Если вы столкнетесь с проблемой и мудро обдумаете ее, это приведет вас к большим вещам","image": "https://sun9-63.userapi.com/impf/c854228/v854228252/15a332/DfugZ3qpcMc.jpg?size=194x362&quality=96&sign=e17de0fea805781bb86b7434cf93b75c&type=album"},
    {"name": "Десятка кубов","prediction": "Когда в раскладе Таро появляется прямая карта Колесница , это говорит вам, что сейчас самое время получить то, что вы хотите. Считайте эту карту знаком поддержки. Карта Таро Колесница — это преодоление препятствий и достижение цели с помощью решимости, сосредоточенности и силы воли. Вы почувствуете мотивацию, амбициозность и контроль.Это поможет вам снова сдвинуть застойную ситуацию и преодолеть все трудности, которые могут встретиться на вашем пути. Просто сосредоточьтесь и верьте в свои способности, и вы добьетесь своей цели. Колесница говорит вам, что вас ждет триумф и что вы полностью контролируете его осуществление. Это может означать, что вам придется соревноваться с другими или что вы окажетесь в ситуации, похожей на битву. Вас тянет в противоположные стороны или вы чувствуете, что ваша сила и уверенность подвергаются испытанию.","image": "https://sun9-25.userapi.com/impf/c854228/v854228252/15a316/GUyUdp5aFvI.jpg?size=194x362&quality=96&sign=1aa0c7d353f035c84947ae37d18718b9&type=album"},
    {"name": "Король жезлов","prediction": "Карта Таро Любовники может означать, что вам предстоит сделать важный выбор, который изменит вашу жизнь, или вы столкнетесь с дилеммой. Искушение часто является частью этого выбора или дилеммы.Во-первых, соберите информацию, необходимую для принятия правильного решения. Если вы столкнетесь с проблемой и мудро обдумаете ее, это приведет вас к большим вещам","image": "https://sun9-23.userapi.com/impf/c854228/v854228252/15a47b/DzACsOuewiY.jpg?size=194x362&quality=96&sign=95e3383b93cfc1cf294fc2457c9be20f&type=album"},
    {"name": "Королева жезлов","prediction": "Карта Таро Любовники может означать, что вам предстоит сделать важный выбор, который изменит вашу жизнь, или вы столкнетесь с дилеммой. Искушение часто является частью этого выбора или дилеммы.Во-первых, соберите информацию, необходимую для принятия правильного решения. Если вы столкнетесь с проблемой и мудро обдумаете ее, это приведет вас к большим вещам","image": "https://sun9-52.userapi.com/impf/c854228/v854228252/15a474/Pv8SUZQ7fAY.jpg?size=194x362&quality=96&sign=6567284546f1e65079fdc2a359fa191e&type=album"},
    {"name": "Рыцарь жезлов","prediction": "Карта Императрицы предвещает жизнь, наполненную гармонией, стабильность, заботу о близких, благоприятную расстановку сил в любом деле. Если в раскладе появляется эта карта, значит, перед вами открыты все пути. Она несет творческую энергию и может предрекать начало нового проекта, отличные возможности для реализации потенциала, раскрытие природного таланта. Иногда выпавшая карта Хозяйки говорит о будущей беременности, а для неженатых/незамужних означает вступление в брак. 3 аркан материализует важную женскую фигуру, покровительницу, которая поможет в решении важного вопроса, направит на истинный путь, даст совет ,как поступить в сложной ситуации.","image": "https://sun9-29.userapi.com/impf/c854228/v854228252/15a46d/YS8AHct8_ps.jpg?size=194x362&quality=96&sign=57b3b761c093eb38c718b478dfb25565&type=album"},
    {"name": "Паж жезлов","prediction": "В общем смысле карта означает воплощение духовного мира, который помогает человеку развиваться, осознавать истинные ценности. Если рассматривать как человеческую фигуру, это наставник, человек, который значительно старше вас, направляющий на правильный путь. Это может быть книга, которая случайно попала к вам в руки, и из нее вы почерпнули серьезное или важное изречение., фильм или учение, руководствуясь которым, вы стали мудрее и добрались до истины. Может символизировать учреждение, где дают знания: школу, институт, религиозные семинарии и церковь. Если речь идет о каком-то деле и выходит карта Иерофанта, значит, развитие ситуации будет зависеть от моральных устоев – пойдете ли вы на сделку со своей совестью.","image": "https://sun9-56.userapi.com/impf/c854228/v854228252/15a466/N-yXhYHSKdM.jpg?size=194x362&quality=96&sign=474c6f100f485b774af41e933d480058&type=album"},
    {"name": "Туз жезлов","prediction": "Карта Таро Любовники может означать, что вам предстоит сделать важный выбор, который изменит вашу жизнь, или вы столкнетесь с дилеммой. Искушение часто является частью этого выбора или дилеммы.Во-первых, соберите информацию, необходимую для принятия правильного решения. Если вы столкнетесь с проблемой и мудро обдумаете ее, это приведет вас к большим вещам","image": "https://sun9-59.userapi.com/impf/c854228/v854228252/15a420/roi6CXUIigY.jpg?size=194x362&quality=96&sign=4dd554138688f915186edffed62dfd81&type=album"},
    {"name": "Двойка мечей","prediction": "В общем смысле карта означает воплощение духовного мира, который помогает человеку развиваться, осознавать истинные ценности. Если рассматривать как человеческую фигуру, это наставник, человек, который значительно старше вас, направляющий на правильный путь. Это может быть книга, которая случайно попала к вам в руки, и из нее вы почерпнули серьезное или важное изречение., фильм или учение, руководствуясь которым, вы стали мудрее и добрались до истины. Может символизировать учреждение, где дают знания: школу, институт, религиозные семинарии и церковь. Если речь идет о каком-то деле и выходит карта Иерофанта, значит, развитие ситуации будет зависеть от моральных устоев – пойдете ли вы на сделку со своей совестью.","image": "https://sun9-7.userapi.com/impf/c854228/v854228252/15a3c5/zpfcSaa7ikU.jpg?size=194x362&quality=96&sign=13c1130f5e1ea0958a11ac47eec1bcea&type=album"},
    ],
    "tarot2": [
    {"name": "Шут", "prediction": "Нулевая карта в колоде Таро, Шут, обладает бесконечным потенциалом и чаще всего выпадает людям, которые находятся в начале жизненного пути. Им еще только предстоит принятие серьезных решений.Основное значение этой карты — невинность, начало пути, предвещающего что-то новое и неизведанное ранее. В трактовке аркана нет ничего зловещего, акцент смещен на эксцентричность персонажа, его необычный взгляд на мир. Карта советует попробовать нестандартные решения, новые теории. Однако в символике аркана заложено также предостережение: необходимо смотреть под ноги и по сторонам, а не погружаться полностью в свои мечты.", "image": "https://sun9-40.userapi.com/impf/c854228/v854228252/15a260/4c9q-BMH72I.jpg?size=194x362&quality=96&sign=11e03d6aca454f66bce24700b073693c&type=album"},
    {"name": "Маг", "prediction": "Карта Мага является предвестником исполнения желания. В Таро Маг говорит об успехе в деле. А именно удачное стечение обстоятельств, которые помогут осуществить вашу мечту. 1 аркан как бы намекает, что сейчас самое время двинуться навстречу своему желанию, для этого у вас есть все ресурсы. Все находится под вашим контролем, и вам нужно действовать активно, спешить использовать это время. Чтобы все сложилось удачно, нужно проявить свою волю, сконцентрироваться на деле. Если говорить конкретно, то все зависит от вас. Будь то романтические, творческие, профессиональные, духовные замыслы, они обязательно исполнятся, как по мановению волшебной палочки Мага. А чтобы не забыть об этом благоприятном времени, установите обои с картой Мага на свой телефон, и он будет вас вдохновлять.", "image": "https://sun9-1.userapi.com/impf/c854228/v854228252/15a267/0fpbWS0ETb0.jpg?size=194x362&quality=96&sign=f67ec096baae2333df40f496c40ade17&type=album"},
    {"name": "Жрица", "prediction": "2 аркан говорит, что истина находится внутри вас. Подсознательно вы знаете ответ на вопрос, нужно лишь сосредоточиться и успокоиться, возможно, побыть некоторое время в одиночестве. Иногда Жрица может указывать на воспоминания, неприятные события в прошлом, которые как-то влияют на вашу жизнь. Если в раскладе выпадает Жрица, то в делах нужно проявить мудрость и терпение, тогда дело будет успешным. ", "image": "https://sun9-2.userapi.com/impf/c854228/v854228252/15a26e/jniVq3mnFw4.jpg?size=194x362&quality=96&sign=7c66226f74fdfdc210d4ab3ae3f4f654&type=album"},
    ],
    "tarot3": [
    {"name": "Шут", "prediction": "Нулевая карта в колоде Таро, Шут, обладает бесконечным потенциалом и чаще всего выпадает людям, которые находятся в начале жизненного пути. Им еще только предстоит принятие серьезных решений.Основное значение этой карты — невинность, начало пути, предвещающего что-то новое и неизведанное ранее. В трактовке аркана нет ничего зловещего, акцент смещен на эксцентричность персонажа, его необычный взгляд на мир. Карта советует попробовать нестандартные решения, новые теории. Однако в символике аркана заложено также предостережение: необходимо смотреть под ноги и по сторонам, а не погружаться полностью в свои мечты.", "image": "https://sun9-40.userapi.com/impf/c854228/v854228252/15a260/4c9q-BMH72I.jpg?size=194x362&quality=96&sign=11e03d6aca454f66bce24700b073693c&type=album"},
    {"name": "Маг", "prediction": "Карта Мага является предвестником исполнения желания. В Таро Маг говорит об успехе в деле. А именно удачное стечение обстоятельств, которые помогут осуществить вашу мечту. 1 аркан как бы намекает, что сейчас самое время двинуться навстречу своему желанию, для этого у вас есть все ресурсы. Все находится под вашим контролем, и вам нужно действовать активно, спешить использовать это время. Чтобы все сложилось удачно, нужно проявить свою волю, сконцентрироваться на деле. Если говорить конкретно, то все зависит от вас. Будь то романтические, творческие, профессиональные, духовные замыслы, они обязательно исполнятся, как по мановению волшебной палочки Мага. А чтобы не забыть об этом благоприятном времени, установите обои с картой Мага на свой телефон, и он будет вас вдохновлять.", "image": "https://sun9-1.userapi.com/impf/c854228/v854228252/15a267/0fpbWS0ETb0.jpg?size=194x362&quality=96&sign=f67ec096baae2333df40f496c40ade17&type=album"},
    {"name": "Жрица", "prediction": "2 аркан говорит, что истина находится внутри вас. Подсознательно вы знаете ответ на вопрос, нужно лишь сосредоточиться и успокоиться, возможно, побыть некоторое время в одиночестве. Иногда Жрица может указывать на воспоминания, неприятные события в прошлом, которые как-то влияют на вашу жизнь. Если в раскладе выпадает Жрица, то в делах нужно проявить мудрость и терпение, тогда дело будет успешным. ", "image": "https://sun9-2.userapi.com/impf/c854228/v854228252/15a26e/jniVq3mnFw4.jpg?size=194x362&quality=96&sign=7c66226f74fdfdc210d4ab3ae3f4f654&type=album"},
    ],
}

@bot.message_handler(commands=['start'])  # Обработчик команды /start
def start(message):  # Функция для приветственного сообщения
    markup = types.ReplyKeyboardMarkup(resize_keyboard=True)  # Создание клавиатуры с кнопками
    markup.add(types.KeyboardButton("Золотое таро"))  # Кнопка для выбора Золотого Таро
    markup.add(types.KeyboardButton("Классическое таро")) 
    markup.add(types.KeyboardButton("Черное таро"))  
    bot.send_message(message.chat.id, f"Привет, {message.from_user.first_name}! Выбери одну из колод Таро", reply_markup=markup)  # Отправка сообщения с кнопками

@bot.message_handler(func=lambda message: message.text in ["Золотое таро", "Классическое таро", "Черное таро"])  # Обработчик нажатия на кнопки выбора колоды
def choose_deck(message):  # Функция для обработки выбора колоды
    deck_mapping = {  # Сопоставление текста с колодой
        "Золотое таро": "tarot1",
        "Классическое таро": "tarot2",
        "Черное таро": "tarot3"
    }

    selected_deck = deck_mapping.get(message.text)  # Определение выбранной колоды
    markup = types.ReplyKeyboardRemove()  # Удаление клавиатуры
    bot.send_message(message.chat.id, "Отличный выбор. Введите ваш вопрос и опишите сложившуюся ситуацию...", reply_markup=markup)  # Запросить вопрос от пользователя
    bot.register_next_step_handler(message, process_question, selected_deck)  # Ожидание следующего сообщения от пользователя и передача выбранной колоды

@validate_deck # Декоратор для проверки, поддерживается ли ответ пользователя (текст, голосовое) или нет (файл, картинка и т.п)
def process_question(message, selected_deck):  # Обработчик ответа пользователя
    if message.content_type == 'text':  # Если сообщение текстовое
        user_input = message.text  # Сохраняем текст вопроса
    elif message.content_type == 'voice':  # Если сообщение голосовое
        file_info = bot.get_file(message.voice.file_id)  # Получаем информацию о голосовом файле
        file_path = f"downloads/{file_info.file_path.split('/')[-1]}"  # Устанавливаем путь для загрузки файла
        downloaded_file = bot.download_file(file_info.file_path)  # Загружаем файл
        with open(file_path, 'wb') as f:  # Сохраняем файл на диск
            f.write(downloaded_file)
        user_input = voice_to_text(file_path)  # Преобразуем голос в текст
    else:
        bot.send_message(message.chat.id, "Данный формат не поддерживается")  # Если формат неподдерживаемый, выводим сообщение
        raise InvalidMessageTypeException()  # Генерируем исключение

    cards = random.sample(cards_decks[selected_deck], 3)  # Случайным образом выбираем 3 карты из выбранной колоды
    response_text = ""  # Начинаем собирать текст для предсказания
    for card in cards:  
        response_text += f"Карта: {card['name']}\nПредсказание: {card['prediction']}\n\n"  # Добавляем информацию о карте и ее предсказании

    ai_input = f"Карты: {[card['name'] for card in cards]}\nОписание ситуации: {user_input}"  
    ai_response = magic_ai(ai_input, max_length=4096, num_return_sequences=1)[0]['generated_text']  # Генерация текста от ИИ на основе карт и ситуации

    bot.send_message(message.chat.id, response_text) 
    bot.send_message(message.chat.id, f"Благодарю. Ваш персональный расклад: {ai_response}")  # Отправляем результат расклада

def voice_to_text(file_path):  # Функция для преобразования голосового сообщения в текст
    recognizer = sr.Recognizer()  # Инициализация распознавателя речи
    audio = AudioSegment.from_file(file_path, format="ogg")  # Загружаем и конвертируем аудио
    wav_path = file_path.replace(".oga", ".wav")  # Меняем формат файла на WAV
    audio.export(wav_path, format="wav")  # Сохраняем файл в формате WAV
    with sr.AudioFile(wav_path) as source:  # Открываем аудиофайл для распознавания
        audio_data = recognizer.record(source)  # Читаем аудио данные
        try:
            text = recognizer.recognize_google(audio_data, language="ru-RU")  # Преобразуем в текст с помощью Google API
            return text  # Возвращаем распознанный текст
        except sr.UnknownValueError:  # Если не удалось распознать
            return "Не удалось распознать ваш вопрос."  # Возвращаем ошибку

bot.polling(none_stop=True)  # Чтобы бот не останавливался
